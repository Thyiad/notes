<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入浅出Node.js笔记 | Thyiad&#39;s notes</title>
    <meta name="generator" content="VuePress 1.7.1">
    <meta name="description" content="I read, I write">
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.f73415d2.js" as="script"><link rel="preload" href="/assets/js/2.4cec8200.js" as="script"><link rel="preload" href="/assets/js/23.6cd7c51b.js" as="script"><link rel="prefetch" href="/assets/js/10.c556e963.js"><link rel="prefetch" href="/assets/js/11.4d984aee.js"><link rel="prefetch" href="/assets/js/12.b834128f.js"><link rel="prefetch" href="/assets/js/13.fe245308.js"><link rel="prefetch" href="/assets/js/14.52669448.js"><link rel="prefetch" href="/assets/js/15.4c140842.js"><link rel="prefetch" href="/assets/js/16.ba292595.js"><link rel="prefetch" href="/assets/js/17.3ddaacb1.js"><link rel="prefetch" href="/assets/js/18.dae9d5f5.js"><link rel="prefetch" href="/assets/js/19.9c10ab5f.js"><link rel="prefetch" href="/assets/js/20.c59ad621.js"><link rel="prefetch" href="/assets/js/21.4f181664.js"><link rel="prefetch" href="/assets/js/22.20785444.js"><link rel="prefetch" href="/assets/js/3.5fe7f172.js"><link rel="prefetch" href="/assets/js/4.09fd2c39.js"><link rel="prefetch" href="/assets/js/5.fc791712.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/7.9fbf953a.js"><link rel="prefetch" href="/assets/js/8.f546e8a2.js"><link rel="prefetch" href="/assets/js/9.c38d618a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Thyiad's notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="node简介"><a href="#node简介" class="header-anchor">#</a> node简介</h3> <p>介绍了nodejs的起源、特点以及应用场景</p> <h3 id="模块机制"><a href="#模块机制" class="header-anchor">#</a> 模块机制</h3> <ul><li><p>nodejs中的模块机制叫做 commonjs</p> <blockquote><p>require, module.exports = {}</p></blockquote></li> <li><p>模块分为两种：核心模块、文件模块</p></li> <li><p>核心模块</p> <ul><li>C/C++编写，放在源码仓库的的src目录下</li> <li>javascript编写，放在源码仓库的lib目录下</li></ul> <blockquote><p>C/C++编写核心模块，javascript负责包装和向外导出
纯 C/C++编写的，被称为内建模块
javascript 核心模块：js文件被v8的js2c.py转换成C++数组，使用时直接从内存中加载
由里到外：内建模块&gt;核心模块&gt;文件模块</p></blockquote></li></ul> <h3 id="异步i-o"><a href="#异步i-o" class="header-anchor">#</a> 异步I/O</h3> <p>其他语言中主要是同步I/O，在node中异步I/O为其主要变成方式和设计理念</p> <p>有4种：异步、同步、阻塞、非阻塞，操作系统只有阻塞I/O和非阻塞I/O</p> <blockquote><p>非/阻塞I/O 还是通过轮询，查询状态，跟异步I/O其实是两回事，很容易混淆
轮询技术的衍变历程：</p></blockquote> <ul><li>read
<blockquote><p>重复检查I/O状态</p></blockquote></li> <li>select
<blockquote><p>对文件描述符上的事件状态进行判断</p></blockquote></li> <li>poll
<blockquote><p>在select的基础上改进，采用链表存储，避免数组长度的问题</p></blockquote></li> <li>epoll
<blockquote><p>最高效，真正的事件通知、执行回调</p></blockquote></li></ul> <p>大概过程：异步调用 -&gt; 线程池执行 -&gt; 事件循环（通知循环中的IO观察者）</p> <p>非IO的异步api：</p> <ul><li>setTimeout</li> <li>setInterval
<blockquote><p>这两者无需IO线程池的参与，在tick中判断是否需要执行
插入到定时器观察者的一个红黑树中</p></blockquote></li> <li>process.nextTick
<blockquote><p>插入队列，下一轮tick中执行</p></blockquote></li> <li>setImmediate
<blockquote><p>优先级低于nextTick，nextTick属于idle观察者，setImmediate属于check观察者</p></blockquote></li></ul> <h3 id="异步编程"><a href="#异步编程" class="header-anchor">#</a> 异步编程</h3> <p>sync async解决了回调地狱
如果调用IO特别多，为了防止并发过多，还是需要自行设计队列来控制并发数</p> <h3 id="内存控制"><a href="#内存控制" class="header-anchor">#</a> 内存控制</h3> <ul><li>内存使用情况：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>node
process.memoryUsage<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  rss<span class="token operator">:</span> <span class="token number">26009600</span><span class="token punctuation">,</span>
  heapTotal<span class="token operator">:</span> <span class="token number">5222400</span><span class="token punctuation">,</span>   <span class="token comment">// 申请到的堆内存</span>
  heapUsed<span class="token operator">:</span> <span class="token number">2962952</span><span class="token punctuation">,</span>    <span class="token comment">// 已使用的内存</span>
  external<span class="token operator">:</span> <span class="token number">1526857</span><span class="token punctuation">,</span>
  arrayBuffers<span class="token operator">:</span> <span class="token number">9399</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>内存对象被分为新生代和老生代两代</li></ul> <blockquote><p>与java, .net很像</p></blockquote> <ul><li>新生代采用scavenge算法（具体实现中采用Cheney算法）</li></ul> <blockquote><p>scavenge: 内存一分为二，从from里把活的复制到to，然后角色翻转（from释放空间变成to，to变成from）</p></blockquote> <ul><li>老生代采用Mark-Sweep &amp; Mark-Compact算法</li></ul> <blockquote><p>Mark-Sweep：引用标记，给活着的对象打上标记，清理未标记的对象
Mark-Sweep 会导致内存碎片（内存不连续）
Mark-Compact 会在清理后把活着的对象移动，使得内存连续</p></blockquote> <ul><li>增量标记、延迟清理、增量式整理</li></ul> <h3 id="理解buffer"><a href="#理解buffer" class="header-anchor">#</a> 理解Buffer</h3> <ul><li>处理字节所用</li> <li>内存分配在C++层面，并不在V8的堆内存中</li> <li>slab 分配机制</li> <li>Node中以8KB为界限来区分Buffer是大对象还是小对象</li></ul> <h3 id="网络编程"><a href="#网络编程" class="header-anchor">#</a> 网络编程</h3> <p>介绍了TCP、Http、WebSocket等原生模块</p> <h3 id="构建web应用"><a href="#构建web应用" class="header-anchor">#</a> 构建Web应用</h3> <p>从基础模块中搭建web应用</p> <h3 id="玩转进程"><a href="#玩转进程" class="header-anchor">#</a> 玩转进程</h3> <p>Cluster</p> <h3 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h3> <p>单元测试、性能测试</p> <h3 id="产品化"><a href="#产品化" class="header-anchor">#</a> 产品化</h3> <p>工程化、部署、性能、日志、监控、稳定性、异构并存</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f73415d2.js" defer></script><script src="/assets/js/2.4cec8200.js" defer></script><script src="/assets/js/23.6cd7c51b.js" defer></script>
  </body>
</html>
