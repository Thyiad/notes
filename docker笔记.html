<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker笔记 | Thyiad&#39;s notes</title>
    <meta name="generator" content="VuePress 1.7.1">
    <meta name="description" content="I read, I write">
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.3fc23183.js" as="script"><link rel="preload" href="/assets/js/2.4cec8200.js" as="script"><link rel="preload" href="/assets/js/15.6fee926f.js" as="script"><link rel="prefetch" href="/assets/js/10.72cd3db3.js"><link rel="prefetch" href="/assets/js/11.e2b57bc5.js"><link rel="prefetch" href="/assets/js/12.ea35c0dc.js"><link rel="prefetch" href="/assets/js/13.ea9b63fa.js"><link rel="prefetch" href="/assets/js/14.daf1f664.js"><link rel="prefetch" href="/assets/js/16.697e83a9.js"><link rel="prefetch" href="/assets/js/17.aa407052.js"><link rel="prefetch" href="/assets/js/18.1e7e93d2.js"><link rel="prefetch" href="/assets/js/19.7aff6255.js"><link rel="prefetch" href="/assets/js/20.c212e72d.js"><link rel="prefetch" href="/assets/js/21.23a9b288.js"><link rel="prefetch" href="/assets/js/22.cf12666f.js"><link rel="prefetch" href="/assets/js/23.fd9e15cf.js"><link rel="prefetch" href="/assets/js/24.ccea6a8c.js"><link rel="prefetch" href="/assets/js/25.23baa043.js"><link rel="prefetch" href="/assets/js/26.e23d8d0a.js"><link rel="prefetch" href="/assets/js/27.1279214f.js"><link rel="prefetch" href="/assets/js/28.4708f798.js"><link rel="prefetch" href="/assets/js/29.47ff9cde.js"><link rel="prefetch" href="/assets/js/3.ae2eb2fd.js"><link rel="prefetch" href="/assets/js/30.736f799a.js"><link rel="prefetch" href="/assets/js/4.09fd2c39.js"><link rel="prefetch" href="/assets/js/5.fc791712.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/7.635bc4d1.js"><link rel="prefetch" href="/assets/js/8.3e386512.js"><link rel="prefetch" href="/assets/js/9.171a9f32.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Thyiad's notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="_1-yum-安装docker"><a href="#_1-yum-安装docker" class="header-anchor">#</a> 1.yum 安装Docker</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># docker 要求centos系统的内核版本高于3.10</span>
<span class="token function">uname</span> -r
yum -y <span class="token function">install</span> docker   <span class="token comment"># -y：对所有提问都回答yes</span>
<span class="token function">service</span> docker start    <span class="token comment"># 启动docker后台服务</span>
docker run hello-world  <span class="token comment"># 测试运行hello-world</span>
</code></pre></div><h3 id="_2-docker-守护进程"><a href="#_2-docker-守护进程" class="header-anchor">#</a> 2.Docker 守护进程</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>docker daemon -H tcp://0.0.0.0:2375 <span class="token comment"># -H调整网络和端口配置</span>
docker daemon -H unix://home/docker/docker.sock <span class="token comment"># 也可以指定一个Unix套接字路径</span>
docker daemon -H tcp://0.0.0.0:2375 -H unix://home/docer/docker.sock    <span class="token comment"># 也可以指定多个绑定地址</span>
docker daemon -D    <span class="token comment"># 输出docker守护进程的详细信息</span>
<span class="token function">service</span> docker status   <span class="token comment"># 检查docker守护进程是否正在运行</span>
<span class="token function">service</span> docker start    <span class="token comment"># 启动docker守护进程</span>
<span class="token function">service</span> docker stop <span class="token comment"># 停止docker守护进程</span>
</code></pre></div><h3 id="_3-容器使用"><a href="#_3-容器使用" class="header-anchor">#</a> 3.容器使用</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run -t -i  运行容器  
<span class="token comment"># 创建一个能进行交互的容器，这两个参数是最基本的，后跟 /bin/bash 之类的参数，指定要运行的程序</span>
<span class="token comment"># -i 保证容器中的STDIN是开启的</span>
<span class="token comment"># -t 告诉docker为要创建的容器分配一个伪tty终端</span>
<span class="token comment"># -d 后台运行（全称：detached，分离）</span>
<span class="token comment"># --name    指定名称</span>
<span class="token comment"># --restart=on-failure:5    容器的退出代码非0时自动重启5次，其他值还有always等等</span>
<span class="token comment"># nginx的话需要 nginx -g &quot;daemon off&quot;，否则运行完容器就退出了，因为nginx是运行一个bash（pid为1），容器是把pid为1的程序作为容器是否正在运行的依据，</span>
<span class="token builtin class-name">exit</span>    <span class="token comment"># 停止并退出容器</span>
docker start    <span class="token comment"># 启动容器</span>
docker attach   <span class="token comment"># 进入容器会话</span>
docker logs <span class="token comment"># 获取容器的日志，-f 跟踪日志，与tail -f相似，-t加上时间戳</span>
docker <span class="token function">top</span> <span class="token comment"># 查看容器内部运行的进程</span>
docker stats <span class="token comment">#查看一个或多个容器的统计信息</span>
docker <span class="token builtin class-name">exec</span> -d test_machine <span class="token function">touch</span> /etc/new_config_file  <span class="token comment"># 在容器内部额外启动新进程</span>
docker stop <span class="token comment"># 停止容器</span>
docker inspect --format <span class="token string">'{{.Name}} {{.State.Running}}'</span> daemon_dave  <span class="token comment"># 获取更多的容器信息，--format 来查看指定信息，后面的容器名可以传递多个（同时查看多个容器的信息）</span>
docker <span class="token function">ps</span>   <span class="token comment"># 查看正在运行的容器， -a 查看所有容器， -q </span>
docker <span class="token function">ps</span> -a <span class="token comment"># 查看所有容器</span>
docker <span class="token function">rm</span> <span class="token comment"># 删除容器</span>
</code></pre></div><h3 id="_4-镜像使用"><a href="#_4-镜像使用" class="header-anchor">#</a> 4.镜像使用</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>docker images  <span class="token comment"># 列出本地主机上的镜像</span>
docker search <span class="token comment"># 查找镜像</span>
docker pull  <span class="token comment"># 下载镜像</span>
docker tag 860c279d2fec runoob/centos:dev <span class="token comment"># 为镜像添加标签</span>
docker rmi  <span class="token comment"># 删除镜像</span>
</code></pre></div><h3 id="_5-日志驱动"><a href="#_5-日志驱动" class="header-anchor">#</a> 5.日志驱动</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run --log-driver<span class="token operator">=</span><span class="token string">&quot;syslog&quot;</span>
</code></pre></div><h3 id="_6-构建镜像"><a href="#_6-构建镜像" class="header-anchor">#</a> 6.构建镜像</h3> <ul><li>创建基础目录</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> static_web
<span class="token builtin class-name">cd</span> static_web
<span class="token function">touch</span> Dockerfile
</code></pre></div><ul><li>填写Dockerfile</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Version: 0.0.1</span>
FROM ubuntu:14.04
MAINTAINER Thyiad Tao <span class="token string">&quot;1520583107@qq.com&quot;</span>
RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y nginx  <span class="token comment"># 也可以用exec格式的RUN指令：RUN [ &quot;apt-get&quot;,&quot;-y&quot;,&quot;nginx&quot; ]</span>
RUN <span class="token builtin class-name">echo</span> <span class="token string">'Hi, Iam in your container'</span> <span class="token punctuation">\</span>
    <span class="token operator">&gt;</span>/usr/share/nginx/html/index.html
EXPOSE <span class="token number">80</span>   <span class="token comment"># EXPOSE指令告诉Docker该容器内的应用程序将会使用容器的指定端口</span>
</code></pre></div><ul><li>编译镜像</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> static_web
docker build -t<span class="token operator">=</span><span class="token string">&quot;thyiad/static_web:v1&quot;</span> <span class="token builtin class-name">.</span>
<span class="token comment"># --no-cache 指定不使用缓存</span>
</code></pre></div><h3 id="_7-volume命令"><a href="#_7-volume命令" class="header-anchor">#</a> 7.volume命令</h3> <div class="language- extra-class"><pre class="language-text"><code>docker volume ls
docker volume inspect --format '{{.Mountpoint}}' xxx_wp_certs
</code></pre></div><blockquote><p>获取这个卷在宿主机中的实际路径</p></blockquote> <h3 id="_7-docker-compose"><a href="#_7-docker-compose" class="header-anchor">#</a> 7.docker compose</h3> <h3 id="docker配置shadowsocks"><a href="#docker配置shadowsocks" class="header-anchor">#</a> docker配置shadowsocks</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>docker run --restart<span class="token operator">=</span>always --name<span class="token operator">=</span>myshadowsocks -d -p <span class="token number">54285</span>:54285 oddrationale/docker-shadowsocks -s <span class="token number">0.0</span>.0.0 -p <span class="token number">54285</span> -k thyiad -m aes-256-cfb
docker <span class="token function">ps</span>
</code></pre></div><h1 id="dockerfile里面的命令"><a href="#dockerfile里面的命令" class="header-anchor">#</a> dockerfile里面的命令</h1> <div class="language- extra-class"><pre class="language-text"><code>FROM
MAINTAINER
ARG
RUN
WORKDIR
COPY  # copy 宿主目录（./xx，编译目录下面的文件、文件夹）到镜像目录
VOLUME
ENTRYPOINT
</code></pre></div><h1 id="编译dockerfile"><a href="#编译dockerfile" class="header-anchor">#</a> 编译dockerfile</h1> <div class="language- extra-class"><pre class="language-text"><code>docker build -t=&quot;thyiad/my-frp:v1&quot; .
</code></pre></div><h1 id="查看卷"><a href="#查看卷" class="header-anchor">#</a> 查看卷</h1> <div class="language- extra-class"><pre class="language-text"><code>docker volume ls
docker volume inspect --format '{{ .Mountpoint }}' 自动前缀_卷名
apt-get update
docker exec
</code></pre></div><h3 id="docker-compose-强制重新编译"><a href="#docker-compose-强制重新编译" class="header-anchor">#</a> docker-compose 强制重新编译</h3> <div class="language- extra-class"><pre class="language-text"><code>docker-compose up -d --no-deps --build &lt;service_name&gt;
</code></pre></div><h3 id="docker-compose-一些配置"><a href="#docker-compose-一些配置" class="header-anchor">#</a> docker-compose 一些配置</h3> <div class="language- extra-class"><pre class="language-text"><code>port:
  - 宿主端口:镜像端口
expose:
  - 8080 # 给其他服务可以访问的接口
volumes:
  - 宿主目录:镜像目录
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3fc23183.js" defer></script><script src="/assets/js/2.4cec8200.js" defer></script><script src="/assets/js/15.6fee926f.js" defer></script>
  </body>
</html>
